# meant to be applied using
# kubectl --namespace kafka patch statefulset kafka --patch "$(cat cruise-control/20kafka-broker-reporter-patch.yml )"
metadata:
  name: kafka
  namespace: kafka
spec:
  template:
    spec:
      initContainers:
      - name: cruise-control-reporter
        image: solsson/kafka-cruise-control-jar@sha256:20a26ae1fab5d63592143093e460d06c4d8f1bef666d592b6393a3b41e3743e8
        command:
        - /bin/sh
        - -cex
        - |
          cp -v /cruise-control-metrics-reporter.jar /opt/kafka/libs/extensions/cruise-control-metrics-reporter.jar
          echo -e "\n\nmetric.reporters = com.linkedin.kafka.cruisecontrol.metricsreporter.CruiseControlMetricsReporter" | tee -a /etc/kafka/server.properties
        volumeMounts:
        - name: config
          mountPath: /etc/kafka
        - name: extensions
          mountPath: /opt/kafka/libs/extensions
      $setElementOrder/initContainers:
      - name: init-config
      - name: cruise-control-reporter
